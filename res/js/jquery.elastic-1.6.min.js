(function(e){e.fn.extend({elastic:function(){var t=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","-moz-box-sizing","box-sizing","-webkit-box-sizing","padding-top","padding-bottom","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){function m(){var e=Math.floor(parseInt(r.width(),10)-parseInt(o,10));console.log("10 curatedWidth:"+e+", $textarea.width():"+r.width()+", $twin.width():"+l.width()+", mozboxsizingdiffx: "+o);if(l.width()!==e){l.css({width:e+"px"});y(true)}}function g(e,t){var n=Math.floor(parseInt(e,10)+parseInt(s,10));if(r.height()!==n){r.css({height:n+"px",overflow:t})}}function y(e){var t=r.val().replace(/&/g,"&").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");var s=0,u=0;var a=l.html().replace(/<br>/ig,"<br />");if(e||t+"&nbsp;"!==a){l.html(t+"&nbsp;");var f=r.width();if(n=="border-box"){f=parseInt(f+parseInt(o,10));l.css({width:f+"px"})}else{l.css({width:f+"px"})}s=l.height();u=r.height()-4;if(Math.abs(s+c-u)>3){var p=s;if(p>=h){g(h,"auto")}else if(p<=i){g(i,"hidden")}else{g(p,"hidden")}}}}if(this.type!=="textarea"){return false}var n="";var r=e(this),i=parseInt(r.css("height"),10)||c*3,s=0,o=0;var u=r.css("display");var a=e().jquery;var f=a.split(".");a=parseInt(f[1]);if(r.css("-moz-box-sizing")){n=r.css("-moz-box-sizing")}else if(r.css("box-sizing")){n=r.css("box-sizing")}else if(r.css("-webkit-box-sizing")){n=r.css("-webkit-box-sizing")}if(n=="border-box"){s=parseInt(r.css("padding-bottom"),10)+parseInt(r.css("padding-top"),10)+parseInt(r.css("border-top-width"),10)+parseInt(r.css("border-bottom-width"),10);i=i-s}else{}o=parseInt(r.css("padding-right"),10)+parseInt(r.css("padding-left"),10)+parseInt(r.css("border-right-width"),10)+parseInt(r.css("border-left-width"),10);var l=e("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"});var c=parseInt(r.css("line-height"),10)||parseInt(r.css("font-size"),"10"),h=parseInt(r.css("max-height"),10)||Number.MAX_VALUE,p=0;if(h<0){h=Number.MAX_VALUE}l.appendTo(r.parent());var d=t.length;while(d--){if(r.css(t[d].toString())){l.css(t[d].toString(),r.css(t[d].toString()))}}var v=r.width();if(n=="border-box"){v=parseInt(v+parseInt(o,10));l.css({width:v+"px"})}else{v=parseInt(v-parseInt(o,10));l.css({width:v+"px"})}r.css({overflow:"hidden"});r.bind("keyup change cut paste",function(){y()});e(window).bind("resize",m);r.bind("resize",m);r.bind("update",y);r.bind("blur",function(){var e=l.height();if(a<8){e=l.height()+s}if(e<h){if(e>i){r.height(e)}else{r.height(i)}}});r.bind("input paste",function(e){setTimeout(y,250)});y()})}})})(jQuery)